<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>STL App</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
    }

    #renderCanvas {
      width: 100%;
      height: 100%;
      touch-action: none;
    }
    #sidebar {
      position: absolute;
      top: 0;
      right: 0;
      width: 300px;
      height: 100%;
      background-color: #f0f0f0;
      padding: 20px;
      box-sizing: border-box;
      overflow-y: auto;
      border-left: 1px solid #ccc;
    }
  </style>
</head>
<body>
    <div id="sidebar">
        <h2>Properties</h2>
            <strong>Name:</strong> <span id="name"></span>
        <ul>
            <li><strong>Position:</strong> <span id="position"></span></li>
            <li><strong>Rotation:</strong> <span id="rotation"></span></li>
            <li><strong>Color:</strong> <span id="color"></span></li>
        </ul>
        <h2>Move Object</h2>
        <button>Q (↑ x Axis)</button>
        <button>A (↓ x Axis)</button>
        <button>W (↑ y Axis)</button>
        <button>S (↓ y Axis)</button>
        <button>E (↑ z Axis)</button>
        <button>D (↓ z Axis)</button>
        <br>
        <h2>Rotate Object</h2>
        <button>R (⤵ x Axis)</button>
        <button>F (⤴ x Axis)</button>
        <button>T (⤵ y Axis)</button>
        <button>G (⤴ y Axis)</button>
        <button>Y (⤵ z Axis)</button>
        <button>H (⤴ z Axis)</button>
        <br>
        <h2>Change Color</h2>
        <input type="color" id="colorPicker">
        <button onclick="changeColor()">Apply Color (Z)</button>
        <br>
        <button id="copy-button">Copy (Ctrl+C)</button>
        <button id="cut-button">Cut (Ctrl+X)</button>
        <button id="paste-button">Paste (Ctrl+V)</button>
        <br><br>
        <button id="downloadJsonButton">Descargar JSON</button>
        <img src="model.jpg" alt="" width="200" height="200">
    </div>
  <canvas id="renderCanvas"></canvas>
  <script src="https://cdn.babylonjs.com/babylon.js"></script>
  <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
  <script src="https://cdn.babylonjs.com/gui/babylon.gui.js"></script>
  <script>
    var canvas = document.getElementById("renderCanvas");
    var engine = new BABYLON.Engine(canvas, true);
    var scene = new BABYLON.Scene(engine);
    var camera = new BABYLON.ArcRotateCamera("camera", 1, 0.8, 10, new BABYLON.Vector3(0, 0, 0), scene);
    camera.attachControl(canvas, true);
    var light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(0, 1, 0), scene);
    var jsonParts = [
  {
      "name": "scarav2",
      "models": "https://raw.githubusercontent.com/ravendano014/scarav2/main/",
      "parts":[
  {
    "mesh_id": "aaan",
    "mesh_name": "GT2 Pulley - 92 teeth - J2.STL",
    "position": [
      {
        "x": 255.09,
        "y": 110,
        "z": 135
      }
    ],
    "rotation": [
      {
        "x": 90,
        "y": 0,
        "z": 0
      }
    ],
    "color": [
      {
        "r": 0.9607843137254902,
        "g": 0.9294117647058824,
        "b": 0
      }
    ]
  },
  {
    "mesh_id": "aaau",
    "mesh_name": "Gripper Hand Right.STL",
    "position": [
      {
        "x": 300,
        "y": 58,
        "z": 141
      }
    ],
    "rotation": [
      {
        "x": 180,
        "y": 90,
        "z": 0
      }
    ],
    "color": [
      {
        "r": 0.7607843137254902,
        "g": 0.7607843137254902,
        "b": 0.8196078431372549
      }
    ]
  },
  {
    "mesh_id": "aaaz",
    "mesh_name": "Gripper link 2.STL",
    "position": [
      {
        "x": 271.38000000001693,
        "y": 64.75999999999462,
        "z": 127.83000000003811
      }
    ],
    "rotation": [
      {
        "x": 90,
        "y": 0,
        "z": 0
      }
    ],
    "color": [
      {
        "r": 1,
        "g": 1,
        "b": 1
      }
    ]
  },
  {
    "mesh_id": "aaaz",
    "mesh_name": "Gripper to J3 connector.STL",
    "position": [
      {
        "x": 271.38000000001693,
        "y": 64.75999999999462,
        "z": 127.83000000003811
      }
    ],
    "rotation": [
      {
        "x": 90,
        "y": 0,
        "z": 0
      }
    ],
    "color": [
      {
        "r": 1,
        "g": 1,
        "b": 1
      }
    ]
  },
  {
    "mesh_id": "aabf",
    "mesh_name": "Z-axis Mount Platform.STL",
    "position": [
      {
        "x": 90,
        "y": 180,
        "z": -118
      }
    ],
    "rotation": [
      {
        "x": 90,
        "y": 0,
        "z": 0
      }
    ],
    "color": [
      {
        "r": 0.011764705882352941,
        "g": 0.043137254901960784,
        "b": 0.9882352941176471
      }
    ]
  },
  {
    "mesh_id": "nYNpX",
    "mesh_name": "Gripper Hand Right.STL",
    "position": [
      {
        "x": 297.63,
        "y": 58,
        "z": 192.45
      }
    ],
    "rotation": [
      {
        "x": 180,
        "y": -90,
        "z": 0
      }
    ],
    "color": [
      {
        "r": 0.7607843137254902,
        "g": 0.7607843137254902,
        "b": 0.8196078431372549
      }
    ]
  },
  {
    "mesh_id": "aabn",
    "mesh_name": "Gripper link 1.STL",
    "position": [
      {
        "x": 284.62,
        "y": 19.220000000000205,
        "z": 192.59999999997035
      }
    ],
    "rotation": [
      {
        "x": 0,
        "y": 90,
        "z": 45
      }
    ],
    "color": [
      {
        "r": 0.9921568627450981,
        "g": 0.9882352941176471,
        "b": 0.9882352941176471
      }
    ]
  },
  {
    "mesh_id": "aabo",
    "mesh_name": "Gripper link 2.STL",
    "position": [
      {
        "x": 288.46,
        "y": 1.7199999999996745,
        "z": 161.23000000002764
      }
    ],
    "rotation": [
      {
        "x": 0,
        "y": 90,
        "z": 45
      }
    ],
    "color": [
      {
        "r": 0.9921568627450981,
        "g": 0.9882352941176471,
        "b": 0.9882352941176471
      }
    ]
  },
  {
    "mesh_id": "ukaq",
    "mesh_name": "Arduino UNO case p1.STL",
    "position": [
      {
        "x": -75.6,
        "y": -77,
        "z": 14.66
      }
    ],
    "rotation": [
      {
        "x": 269.87999999998874,
        "y": 0,
        "z": 0
      }
    ],
    "color": [
      {
        "r": 0.011764705882352941,
        "g": 0.043137254901960784,
        "b": 0.9882352941176471
      }
    ]
  },
  {
    "mesh_id": "aaaa",
    "mesh_name": "Arduino UNO case p2.STL",
    "position": [
      {
        "x": -70.8,
        "y": -72,
        "z": 15
      }
    ],
    "rotation": [
      {
        "x": -90.19999999999493,
        "y": 0,
        "z": 0
      }
    ],
    "color": [
      {
        "r": 0.011764705882352941,
        "g": 0.043137254901960784,
        "b": 0.9882352941176471
      }
    ]
  },
  {
    "mesh_id": "aaab",
    "mesh_name": "Arm 1 Cover.STL",
    "position": [
      {
        "x": 188,
        "y": 179.94,
        "z": 4
      }
    ],
    "rotation": [
      {
        "x": 90,
        "y": -90,
        "z": 0
      }
    ],
    "color": [
      {
        "r": 0.011764705882352941,
        "g": 0.043137254901960784,
        "b": 0.9882352941176471
      }
    ]
  },
  {
    "mesh_id": "aaac",
    "mesh_name": "Arm 1.STL",
    "position": [
      {
        "x": 110,
        "y": 134.95000000000277,
        "z": 4.189999999999914
      }
    ],
    "rotation": [
      {
        "x": -90,
        "y": 0,
        "z": -90
      }
    ],
    "color": [
      {
        "r": 0.011764705882352941,
        "g": 0.043137254901960784,
        "b": 0.9882352941176471
      }
    ]
  },
  {
    "mesh_id": "aaae",
    "mesh_name": "Arm 2 Cover.STL",
    "position": [
      {
        "x": 111,
        "y": 86.66,
        "z": 132
      }
    ],
    "rotation": [
      {
        "x": 90,
        "y": 0,
        "z": 0
      }
    ],
    "color": [
      {
        "r": 0.011764705882352941,
        "g": 0.043137254901960784,
        "b": 0.9882352941176471
      }
    ]
  },
  {
    "mesh_id": "aaaf",
    "mesh_name": "Arm 2.STL",
    "position": [
      {
        "x": 111,
        "y": 116.56,
        "z": 132
      }
    ],
    "rotation": [
      {
        "x": 90,
        "y": 0,
        "z": 0
      }
    ],
    "color": [
      {
        "r": 0.011764705882352941,
        "g": 0.043137254901960784,
        "b": 0.9882352941176471
      }
    ]
  },
  {
    "mesh_id": "aaah",
    "mesh_name": "Base cover.STL",
    "position": [
      {
        "x": 210,
        "y": 20,
        "z": -118
      }
    ],
    "rotation": [
      {
        "x": 90,
        "y": 270,
        "z": 0
      }
    ],
    "color": [
      {
        "r": 0.011764705882352941,
        "g": 0.043137254901960784,
        "b": 0.9882352941176471
      }
    ]
  },
  {
    "mesh_id": "aaai",
    "mesh_name": "Base.STL",
    "position": [
      {
        "x": 0,
        "y": -77.48000000000273,
        "z": 13.94999999999974
      }
    ],
    "rotation": [
      {
        "x": -90,
        "y": 0,
        "z": 0
      }
    ],
    "color": [
      {
        "r": 0.011764705882352941,
        "g": 0.043137254901960784,
        "b": 0.9882352941176471
      }
    ]
  },
  {
    "mesh_id": "aaaj",
    "mesh_name": "GT2 Pulley - 110 teeth - J1.STL",
    "position": [
      {
        "x": 108.8900000000188,
        "y": -39.58000000000069,
        "z": -89.09000000000867
      }
    ],
    "rotation": [
      {
        "x": 90,
        "y": 0,
        "z": 0
      }
    ],
    "color": [
      {
        "r": 0.9607843137254902,
        "g": 0.9294117647058824,
        "b": 0
      }
    ]
  },
  {
    "mesh_id": "aaak",
    "mesh_name": "GT2 Pulley - 22 - 80 teeth.STL",
    "position": [
      {
        "x": 116,
        "y": 163.80999999999483,
        "z": 44
      }
    ],
    "rotation": [
      {
        "x": 90,
        "y": 0,
        "z": 0
      }
    ],
    "color": [
      {
        "r": 0.9607843137254902,
        "g": 0.9294117647058824,
        "b": 0
      }
    ]
  },
  {
    "mesh_id": "aaal",
    "mesh_name": "GT2 Pulley - 23 - 80 teeth.STL",
    "position": [
      {
        "x": 45,
        "y": -62.00000000000001,
        "z": -31
      }
    ],
    "rotation": [
      {
        "x": -90,
        "y": 0,
        "z": 0
      }
    ],
    "color": [
      {
        "r": 0.9607843137254902,
        "g": 0.9294117647058824,
        "b": 0
      }
    ]
  },
  {
    "mesh_id": "aaam",
    "mesh_name": "GT2 Pulley - 90 teeth - J3.STL",
    "position": [
      {
        "x": 120,
        "y": 141,
        "z": 200
      }
    ],
    "rotation": [
      {
        "x": -90,
        "y": 0,
        "z": 0
      }
    ],
    "color": [
      {
        "r": 0.9607843137254902,
        "g": 0.9294117647058824,
        "b": 0
      }
    ]
  },
  {
    "mesh_id": "aaan",
    "mesh_name": "GT2 Pulley - 92 teeth - J2.STL",
    "position": [
      {
        "x": 255.09,
        "y": 110,
        "z": 135
      }
    ],
    "rotation": [
      {
        "x": 90,
        "y": 0,
        "z": 0
      }
    ],
    "color": [
      {
        "r": 0.9607843137254902,
        "g": 0.9294117647058824,
        "b": 0
      }
    ]
  },
  {
    "mesh_id": "aaao",
    "mesh_name": "GT2 Pulley - Parametric.STL",
    "position": [
      {
        "x": 28,
        "y": -44.98,
        "z": -28
      }
    ],
    "rotation": [
      {
        "x": 90,
        "y": 0,
        "z": 0
      }
    ],
    "color": [
      {
        "r": 0.9607843137254902,
        "g": 0.9294117647058824,
        "b": 0
      }
    ]
  },
  {
    "mesh_id": "aaap",
    "mesh_name": "Gripper Cover.STL",
    "position": [
      {
        "x": 300,
        "y": 59.20000000000016,
        "z": 188
      }
    ],
    "rotation": [
      {
        "x": 0,
        "y": -90,
        "z": 180
      }
    ],
    "color": [
      {
        "r": 0.8745098039215686,
        "g": 0.8745098039215686,
        "b": 0.8862745098039215
      }
    ]
  },
  {
    "mesh_id": "aaaq",
    "mesh_name": "Gripper End.STL",
    "position": [
      {
        "x": 296.68,
        "y": -51.81999999999944,
        "z": 118.11
      }
    ],
    "rotation": [
      {
        "x": 0,
        "y": 0,
        "z": 90
      }
    ],
    "color": [
      {
        "r": 0.9921568627450981,
        "g": 0.9882352941176471,
        "b": 0.9882352941176471
      }
    ]
  },
  {
    "mesh_id": "aaas",
    "mesh_name": "Gripper Hand Left.STL",
    "position": [
      {
        "x": 270,
        "y": 58,
        "z": 115
      }
    ],
    "rotation": [
      {
        "x": 180,
        "y": -90,
        "z": 0
      }
    ],
    "color": [
      {
        "r": 0.7607843137254902,
        "g": 0.7607843137254902,
        "b": 0.8196078431372549
      }
    ]
  },
  {
    "mesh_id": "aaau",
    "mesh_name": "Gripper Hand Right.STL",
    "position": [
      {
        "x": 300,
        "y": 58,
        "z": 141
      }
    ],
    "rotation": [
      {
        "x": 180,
        "y": 90,
        "z": 0
      }
    ],
    "color": [
      {
        "r": 0.7607843137254902,
        "g": 0.7607843137254902,
        "b": 0.8196078431372549
      }
    ]
  },
  {
    "mesh_id": "aaaw",
    "mesh_name": "Gripper Mechanism Slider.STL",
    "position": [
      {
        "x": 279.0599999999963,
        "y": -4.3199999999999505,
        "z": 120
      }
    ],
    "rotation": [
      {
        "x": 0,
        "y": 0,
        "z": 0
      }
    ],
    "color": [
      {
        "r": 0.8823529411764706,
        "g": 0.8823529411764706,
        "b": 0.8980392156862745
      }
    ]
  },
  {
    "mesh_id": "aaax",
    "mesh_name": "Gripper Servo Holder.STL",
    "position": [
      {
        "x": 275,
        "y": 59.5000000000001,
        "z": 145
      }
    ],
    "rotation": [
      {
        "x": 0,
        "y": 90,
        "z": 180
      }
    ],
    "color": [
      {
        "r": 0.8745098039215686,
        "g": 0.8745098039215686,
        "b": 0.8862745098039215
      }
    ]
  },
  {
    "mesh_id": "aaay",
    "mesh_name": "Gripper Wide end.STL",
    "position": [
      {
        "x": 129.92,
        "y": 177.0000000000009,
        "z": 7.01
      }
    ],
    "rotation": [
      {
        "x": 90,
        "y": 0,
        "z": 0
      }
    ],
    "color": [
      {
        "r": 0,
        "g": 0.9607843137254902,
        "b": 0.33725490196078434
      }
    ]
  },
  {
    "mesh_id": "aaaz",
    "mesh_name": "Gripper link 1.STL",
    "position": [
      {
        "x": 271.38000000001693,
        "y": 64.75999999999462,
        "z": 127.83000000003811
      }
    ],
    "rotation": [
      {
        "x": 90,
        "y": 0,
        "z": 0
      }
    ],
    "color": [
      {
        "r": 1,
        "g": 1,
        "b": 1
      }
    ]
  },
  {
    "mesh_id": "aaaz",
    "mesh_name": "Gripper link 2.STL",
    "position": [
      {
        "x": 271.38000000001693,
        "y": 64.75999999999462,
        "z": 127.83000000003811
      }
    ],
    "rotation": [
      {
        "x": 90,
        "y": 0,
        "z": 0
      }
    ],
    "color": [
      {
        "r": 1,
        "g": 1,
        "b": 1
      }
    ]
  },
  {
    "mesh_id": "aaaz",
    "mesh_name": "Gripper to J3 connector.STL",
    "position": [
      {
        "x": 271.38000000001693,
        "y": 64.75999999999462,
        "z": 127.83000000003811
      }
    ],
    "rotation": [
      {
        "x": 90,
        "y": 0,
        "z": 0
      }
    ],
    "color": [
      {
        "r": 1,
        "g": 1,
        "b": 1
      }
    ]
  },
  {
    "mesh_id": "aaba",
    "mesh_name": "J1 coupler.STL",
    "position": [
      {
        "x": 89.32000000000879,
        "y": -37.93000000000102,
        "z": 2.8499999999999623
      }
    ],
    "rotation": [
      {
        "x": -90,
        "y": 0,
        "z": 0
      }
    ],
    "color": [
      {
        "r": 0.011764705882352941,
        "g": 0.043137254901960784,
        "b": 0.9882352941176471
      }
    ]
  },
  {
    "mesh_id": "aabb",
    "mesh_name": "J2 Coupler.STL",
    "position": [
      {
        "x": 111,
        "y": 116.86,
        "z": 210
      }
    ],
    "rotation": [
      {
        "x": -90,
        "y": 0,
        "z": 0
      }
    ],
    "color": [
      {
        "r": 0.011764705882352941,
        "g": 0.043137254901960784,
        "b": 0.9882352941176471
      }
    ]
  },
  {
    "mesh_id": "aabc",
    "mesh_name": "J3 Coupler.STL",
    "position": [
      {
        "x": 251,
        "y": 65,
        "z": 210
      }
    ],
    "rotation": [
      {
        "x": -90,
        "y": 0,
        "z": 0
      }
    ],
    "color": [
      {
        "r": 0.011764705882352941,
        "g": 0.043137254901960784,
        "b": 0.9882352941176471
      }
    ]
  },
  {
    "mesh_id": "aabe",
    "mesh_name": "Top cover.STL",
    "position": [
      {
        "x": 210,
        "y": 290,
        "z": -120
      }
    ],
    "rotation": [
      {
        "x": -90,
        "y": 180,
        "z": 0
      }
    ],
    "color": [
      {
        "r": 0.011764705882352941,
        "g": 0.043137254901960784,
        "b": 0.9882352941176471
      }
    ]
  },
  {
    "mesh_id": "aabd",
    "mesh_name": "Z-axis Bottom Plate.STL",
    "position": [
      {
        "x": 150.67999999998716,
        "y": -1.359999999999745,
        "z": -142.68000000001638
      }
    ],
    "rotation": [
      {
        "x": 90,
        "y": -45.47999999999771,
        "z": 0
      }
    ],
    "color": [
      {
        "r": 0.011764705882352941,
        "g": 0.043137254901960784,
        "b": 0.9882352941176471
      }
    ]
  },
  {
    "mesh_id": "aabe",
    "mesh_name": "Z-axis Bottom Plate.STL",
    "position": [
      {
        "x": 210,
        "y": 290,
        "z": -120
      }
    ],
    "rotation": [
      {
        "x": -90,
        "y": 180,
        "z": 0
      }
    ],
    "color": [
      {
        "r": 0.011764705882352941,
        "g": 0.043137254901960784,
        "b": 0.9882352941176471
      }
    ]
  },
  {
    "mesh_id": "aabf",
    "mesh_name": "Z-axis Mount Platform.STL",
    "position": [
      {
        "x": 90,
        "y": 180,
        "z": -118
      }
    ],
    "rotation": [
      {
        "x": 90,
        "y": 0,
        "z": 0
      }
    ],
    "color": [
      {
        "r": 0.011764705882352941,
        "g": 0.043137254901960784,
        "b": 0.9882352941176471
      }
    ]
  },
  {
    "mesh_id": "aabh",
    "mesh_name": "Z-axis Top Plate.STL",
    "position": [
      {
        "x": 210,
        "y": 295,
        "z": -120
      }
    ],
    "rotation": [
      {
        "x": -90,
        "y": 180,
        "z": 0
      }
    ],
    "color": [
      {
        "r": 0.011764705882352941,
        "g": 0.043137254901960784,
        "b": 0.9882352941176471
      }
    ]
  },
  {
    "mesh_id": "aabi",
    "mesh_name": "nut_job_20180909-67-1pjk6pi.stl",
    "position": [
      {
        "x": 148.8500000000096,
        "y": -1.6500000000000015,
        "z": -24.480000000001027
      }
    ],
    "rotation": [
      {
        "x": 0,
        "y": 0,
        "z": 0
      }
    ],
    "color": [
      {
        "r": 1,
        "g": 1,
        "b": 1
      }
    ]
  },
  {
    "mesh_id": "aabj",
    "mesh_name": "cylinder.stl",
    "position": [
      {
        "x": 184.19999999997745,
        "y": -0.6300000000000003,
        "z": -24.57000000000104
      }
    ],
    "rotation": [
      {
        "x": 0,
        "y": 0,
        "z": 0
      }
    ],
    "color": [
      {
        "r": 0.8823529411764706,
        "g": 0.8823529411764706,
        "b": 0.8980392156862745
      }
    ]
  },
  {
    "mesh_id": "aabk",
    "mesh_name": "cylinder.stl",
    "position": [
      {
        "x": 117.98000000002345,
        "y": 0,
        "z": -23.680000000000902
      }
    ],
    "rotation": [
      {
        "x": 0,
        "y": 0,
        "z": 0
      }
    ],
    "color": [
      {
        "r": 0.8823529411764706,
        "g": 0.8823529411764706,
        "b": 0.8980392156862745
      }
    ]
  },
  {
    "mesh_id": "aabl",
    "mesh_name": "cylinder.stl",
    "position": [
      {
        "x": 183.42999999997815,
        "y": -1.110000000000001,
        "z": -91.42000000000986
      }
    ],
    "rotation": [
      {
        "x": 0,
        "y": 0,
        "z": 0
      }
    ],
    "color": [
      {
        "r": 0.8823529411764706,
        "g": 0.8823529411764706,
        "b": 0.8980392156862745
      }
    ]
  },
  {
    "mesh_id": "aabm",
    "mesh_name": "cylinder.stl",
    "position": [
      {
        "x": 116.76000000002283,
        "y": 0,
        "z": -92.00000000001016
      }
    ],
    "rotation": [
      {
        "x": 0,
        "y": 0,
        "z": 0
      }
    ],
    "color": [
      {
        "r": 0.8823529411764706,
        "g": 0.8823529411764706,
        "b": 0.8980392156862745
      }
    ]
  },
  {
    "mesh_id": "nYNpX",
    "mesh_name": "Gripper Hand Right.STL",
    "position": [
      {
        "x": 297.63,
        "y": 58,
        "z": 192.45
      }
    ],
    "rotation": [
      {
        "x": 180,
        "y": -90,
        "z": 0
      }
    ],
    "color": [
      {
        "r": 0.7607843137254902,
        "g": 0.7607843137254902,
        "b": 0.8196078431372549
      }
    ]
  },
  {
    "mesh_id": "NRHvM",
    "mesh_name": "Gripper Hand Left.STL",
    "position": [
      {
        "x": 278.15,
        "y": 58,
        "z": 220.85
      }
    ],
    "rotation": [
      {
        "x": 180,
        "y": 90,
        "z": 0
      }
    ],
    "color": [
      {
        "r": 0.7607843137254902,
        "g": 0.7607843137254902,
        "b": 0.8196078431372549
      }
    ]
  },
  {
    "mesh_id": "XohJL",
    "mesh_name": "Gripper End.STL",
    "position": [
      {
        "x": 275.36,
        "y": -49,
        "z": 215.97
      }
    ],
    "rotation": [
      {
        "x": 0,
        "y": 180,
        "z": 90
      }
    ],
    "color": [
      {
        "r": 0.9921568627450981,
        "g": 0.9882352941176471,
        "b": 0.9882352941176471
      }
    ]
  },
  {
    "mesh_id": "hMFep",
    "mesh_name": "Gripper Mechanism Slider.STL",
    "position": [
      {
        "x": 297.5399999999977,
        "y": -5.55999999999994,
        "z": 212.769999999927
      }
    ],
    "rotation": [
      {
        "x": 0,
        "y": 180,
        "z": 0
      }
    ],
    "color": [
      {
        "r": 0.8823529411764706,
        "g": 0.8823529411764706,
        "b": 0.8980392156862745
      }
    ]
  },
  {
    "mesh_id": "aabn",
    "mesh_name": "Gripper link 1.STL",
    "position": [
      {
        "x": 284.62,
        "y": 19.220000000000205,
        "z": 192.59999999997035
      }
    ],
    "rotation": [
      {
        "x": 0,
        "y": 90,
        "z": 45
      }
    ],
    "color": [
      {
        "r": 0.9921568627450981,
        "g": 0.9882352941176471,
        "b": 0.9882352941176471
      }
    ]
  },
  {
    "mesh_id": "aabo",
    "mesh_name": "Gripper link 2.STL",
    "position": [
      {
        "x": 288.46,
        "y": 1.7199999999996745,
        "z": 161.23000000002764
      }
    ],
    "rotation": [
      {
        "x": 0,
        "y": 90,
        "z": 45
      }
    ],
    "color": [
      {
        "r": 0.9921568627450981,
        "g": 0.9882352941176471,
        "b": 0.9882352941176471
      }
    ]
  },
  {
    "mesh_id": "aabp",
    "mesh_name": "tube.stl",
    "position": [
      {
        "x": 289.94,
        "y": 46.99,
        "z": 112
      }
    ],
    "rotation": [
      {
        "x": 0,
        "y": 0,
        "z": 0
      }
    ],
    "color": [
      {
        "r": 0.8823529411764706,
        "g": 0.8823529411764706,
        "b": 0.8980392156862745
      }
    ]
  },
  {
    "mesh_id": "aabq",
    "mesh_name": "tube.stl",
    "position": [
      {
        "x": 287.19,
        "y": 2,
        "z": 112
      }
    ],
    "rotation": [
      {
        "x": 0,
        "y": 0,
        "z": 0
      }
    ],
    "color": [
      {
        "r": 0.8823529411764706,
        "g": 0.8823529411764706,
        "b": 0.8980392156862745
      }
    ]
  },
  {
    "mesh_id": "aabr",
    "mesh_name": "2051_servo_tower-pro-sg90.pk2.stl",
    "position": [
      {
        "x": 273.27000000001266,
        "y": 4.489999999999947,
        "z": 218.4799999999259
      }
    ],
    "rotation": [
      {
        "x": 0,
        "y": 180,
        "z": 90
      }
    ],
    "color": [
      {
        "r": 0.3137254901960784,
        "g": 0.3058823529411765,
        "b": 0.3058823529411765
      }
    ]
  },
  {
    "mesh_id": "aabs",
    "mesh_name": "stepper_motor.stl",
    "position": [
      {
        "x": 145.17,
        "y": 40.96,
        "z": 170
      }
    ],
    "rotation": [
      {
        "x": 0,
        "y": 0,
        "z": -90
      }
    ],
    "color": [
      {
        "r": 0.3137254901960784,
        "g": 0.3058823529411765,
        "b": 0.3058823529411765
      }
    ]
  },
  {
    "mesh_id": "aabu",
    "mesh_name": "stepper_motor.stl",
    "position": [
      {
        "x": 151.24000000012364,
        "y": 218.789999999946,
        "z": -67.54000000001804
      }
    ],
    "rotation": [
      {
        "x": 0,
        "y": 0,
        "z": 90
      }
    ],
    "color": [
      {
        "r": 0.3137254901960784,
        "g": 0.3058823529411765,
        "b": 0.3058823529411765
      }
    ]
  },
  {
    "mesh_id": "aabv",
    "mesh_name": "stepper_motor.stl",
    "position": [
      {
        "x": 149.95000000012482,
        "y": 358.479999999819,
        "z": -26.510000000021737
      }
    ],
    "rotation": [
      {
        "x": 0,
        "y": 0,
        "z": 90
      }
    ],
    "color": [
      {
        "r": 0.3137254901960784,
        "g": 0.3058823529411765,
        "b": 0.3058823529411765
      }
    ]
  },
  {
    "mesh_id": "BKWMC",
    "mesh_name": "stepper_motor.stl",
    "position": [
      {
        "x": 35.270000000135944,
        "y": 2.7000000000181608,
        "z": -20.360000000020776
      }
    ],
    "rotation": [
      {
        "x": 0,
        "y": 45,
        "z": 90
      }
    ],
    "color": [
      {
        "r": 0.3137254901960784,
        "g": 0.3058823529411765,
        "b": 0.3058823529411765
      }
    ]
  },
  {
    "mesh_id": "aabx",
    "mesh_name": "ArduinoUNOR3.stl",
    "position": [
      {
        "x": -5.499999999999934,
        "y": -38.76000000000086,
        "z": -39.5400000000007
      }
    ],
    "rotation": [
      {
        "x": 0,
        "y": 0,
        "z": 0
      }
    ],
    "color": [
      {
        "r": 0.3137254901960784,
        "g": 0.3058823529411765,
        "b": 0.3058823529411765
      }
    ]
  },
  {
    "mesh_id": "aaby",
    "mesh_name": "Laser Module.stl",
    "position": [
      {
        "x": 250,
        "y": -12,
        "z": 160
      }
    ],
    "rotation": [
      {
        "x": 0,
        "y": 0,
        "z": 0
      }
    ],
    "color": [
      {
        "r": 0.3137254901960784,
        "g": 0.3058823529411765,
        "b": 0.3058823529411765
      }
    ]
  }
]
  }];

        const localAxes = new BABYLON.AxesViewer(scene, 1);


        // Cargar y posicionar cada parte del modelo 3D 
        function loadAndPositionPart(part) {
            var meshURL = jsonParts[0].models;
            var meshName = part.mesh_name;

            BABYLON.SceneLoader.ImportMesh("", meshURL, meshName, scene, function (meshes) {
                // Colocar la parte en su posición
                meshes[0].id = part.mesh_id;
                meshes[0].name = part.mesh_name;
                meshes[0].position = new BABYLON.Vector3(part.position[0].x, part.position[0].y, part.position[0].z);
                meshes[0].rotation = new BABYLON.Vector3(BABYLON.Tools.ToRadians(part.rotation[0].x), BABYLON.Tools.ToRadians(part.rotation[0].y), BABYLON.Tools.ToRadians(part.rotation[0].z));
            
                meshes[0].material = new BABYLON.StandardMaterial("material", scene);
                meshes[0].material.diffuseColor = new BABYLON.Color3.FromHexString(rgbToHex(part.color[0].r*255, part.color[0].g*255, part.color[0].b*255));
            
            });
        }


        for (var i = 0; i < jsonParts[0].parts.length; i++) {
            loadAndPositionPart(jsonParts[0].parts[i], new BABYLON.Vector3(0, 0, 0));
        }
        // console.log(scene);

      window.addEventListener('dblclick', function() {        
        var pickResult = scene.pick(scene.pointerX, scene.pointerY);        

        var meshName = pickResult.pickedMesh.name;

        if (meshName.includes('picker_')) {
            return false;
        }

        var mat = new BABYLON.StandardMaterial('mat1', this.scene);
        mat.diffuseColor = new BABYLON.Color3(1, 0, 0);

        var sphere = BABYLON.MeshBuilder.CreateSphere(
        'picker_sphere',
        { diameter: 2, segments: 16 },
        scene
        );
        sphere.material = mat;
        sphere.position.y = 3;

        var cube = BABYLON.MeshBuilder.CreateBox(
        'picker_cube',
        { size: 0.5, height: 3 },
        scene
        );
        cube.position = new BABYLON.Vector3(0, 1.5, 0);
        cube.material = mat;

        var mesh = BABYLON.Mesh.MergeMeshes([sphere, cube]);

        mesh.position = pickResult.pickedPoint;
				
        // !!!!!!!!!!!!!!!!!!!!!
        // ROTATION MUST BE HERE
        // !!!!!!!!!!!!!!!!!!!!!
                        
        var axis1 = pickResult.getNormal();							        		
        var axis2 = BABYLON.Vector3.Up();
        var axis3 = BABYLON.Vector3.Up();
        var start = new BABYLON.Vector3(Math.PI / 2, Math.PI / 2, 0);	//camera.position			

        BABYLON.Vector3.CrossToRef(start, axis1, axis2);
        BABYLON.Vector3.CrossToRef(axis2, axis1, axis3);
        var tmpVec = BABYLON.Vector3.RotationFromAxis(axis3.negate(), axis1, axis2);
        var quat = BABYLON.Quaternion.RotationYawPitchRoll(tmpVec.y, tmpVec.x, tmpVec.z);
        mesh.rotationQuaternion = quat;
    });

        engine.runRenderLoop(function () {
            scene.render();
        });

        window.addEventListener("resize", function () {
            engine.resize();
        });


    let pickedMesh = null;
    scene.onPointerMove = function() {
        var result = scene.pick(scene.pointerX, scene.pointerY);
        if (result.pickedMesh !== pickedMesh) {            
            if (pickedMesh) {
                pickedMesh.disableEdgesRendering(); 
            }

            pickedMesh = result.pickedMesh;
            if (pickedMesh) {
                pickedMesh.edgesWidth = 40.0;
                pickedMesh.edgesColor = new BABYLON.Color4(0, 1, 0.87);
                pickedMesh.enableEdgesRendering();
                selectedMesh = pickedMesh;

                 // Mostrar propiedades en la barra lateral
                document.getElementById("name").textContent = pickedMesh.name;
                document.getElementById("position").textContent = `X: ${pickedMesh.position.x.toFixed(2)}, Y: ${pickedMesh.position.y.toFixed(2)}, Z: ${pickedMesh.position.z.toFixed(2)}`;
                document.getElementById("rotation").textContent = `X: ${BABYLON.Tools.ToDegrees(pickedMesh.rotation.x).toFixed(2)}°, Y: ${BABYLON.Tools.ToDegrees(pickedMesh.rotation.y).toFixed(2)}°, Z: ${BABYLON.Tools.ToDegrees(pickedMesh.rotation.z).toFixed(2)}°`;
                document.getElementById("color").textContent = `Color: ${pickedMesh.material ? pickedMesh.material.diffuseColor.toString() : "N/A"}`;

                window.addEventListener("keydown", function (event) {
                var speed = 0.01;
                switch (event.key) {
                    case "q":
                    pickedMesh.position.x += speed;
                    break;
                    case "a":
                    pickedMesh.position.x -= speed;
                    break;
                    case "w":
                    pickedMesh.position.y += speed;
                    break;
                    case "s":
                    pickedMesh.position.y -= speed;
                    break;
                    case "e":
                    pickedMesh.position.z += speed;
                    break;
                    case "d":
                    pickedMesh.position.z -= speed;
                    break;
                    case "r":
                    pickedMesh.rotation.x += BABYLON.Tools.ToRadians(speed);
                    break;
                    case "f":
                    pickedMesh.rotation.x -= BABYLON.Tools.ToRadians(speed);
                    break;
                    case "t":
                    pickedMesh.rotation.y += BABYLON.Tools.ToRadians(speed);
                    break;
                    case "g":
                    pickedMesh.rotation.y -= BABYLON.Tools.ToRadians(speed);
                    break;
                    case "y":
                    pickedMesh.rotation.z += BABYLON.Tools.ToRadians(speed);
                    break;
                    case "h":
                    pickedMesh.rotation.z -= BABYLON.Tools.ToRadians(speed);
                    break;
                }

                // Encuentra la parte correspondiente en jsonParts y actualiza sus propiedades
                var partIndex = jsonParts[0].parts.findIndex(function (jsonPart) {
                return jsonPart.mesh_id === pickedMesh.id;
                });

                if (partIndex !== -1) {
                    var updatedPart = jsonParts[0].parts[partIndex];
                    updatedPart.position[0].x = pickedMesh.position.x;
                    updatedPart.position[0].y = pickedMesh.position.y;
                    updatedPart.position[0].z = pickedMesh.position.z;
                    updatedPart.rotation[0].x = BABYLON.Tools.ToDegrees(pickedMesh.rotation.x);
                    updatedPart.rotation[0].y = BABYLON.Tools.ToDegrees(pickedMesh.rotation.y);
                    updatedPart.rotation[0].z = BABYLON.Tools.ToDegrees(pickedMesh.rotation.z);
                    updatedPart.color[0] = pickedMesh.material.diffuseColor;
                }
                // console.log(jsonParts);

                });
            
            }
        }
    };

// Función para recopilar la información actualizada de las partes y descargar el JSON
function downloadJson() {
  // console.log(scene);
  const updatedParts = jsonParts[0].parts.map((part) => {
    const mesh = scene.getMeshByID(part.mesh_id);
    return {
      mesh_id: part.mesh_id,
      mesh_name: part.mesh_name,
      position:  [{
        x: mesh.position.x,
        y: mesh.position.y,
        z: mesh.position.z,
      }],
      rotation: [{
        x: BABYLON.Tools.ToDegrees(mesh.rotation.x),
        y: BABYLON.Tools.ToDegrees(mesh.rotation.y),
        z: BABYLON.Tools.ToDegrees(mesh.rotation.z),
      }],
      color: [mesh.material.diffuseColor]
    };
  });

  const jsonContent = JSON.stringify(updatedParts, null, 2);
  const blob = new Blob([jsonContent], { type: "application/json" });
  const url = URL.createObjectURL(blob);

  // Crear un enlace para la descarga
  const downloadLink = document.createElement("a");
  downloadLink.href = url;
  downloadLink.download = "model.json";
  downloadLink.click();

  // Liberar la URL del objeto Blob
  URL.revokeObjectURL(url);
}

// Asigna la función downloadJson al botón de descarga
document.getElementById("downloadJsonButton").addEventListener("click", downloadJson);

document.addEventListener("keydown", function (event) {
    if (event.key === "z") {
        // Llama a la función changeColor() al presionar la tecla "Z"
        changeColor();
    }
    if (event.ctrlKey) {
        if (event.key === 'c' || event.key === 'C') {
            // Ctrl+C: Copiar las shapes seleccionadas al portapapeles
            copyPart();
        } else if (event.key === 'x' || event.key === 'X') {
            // Ctrl+X: Cortar las shapes seleccionadas al portapapeles y eliminarlas
            cutPart();
        } else if (event.key === 'v' || event.key === 'V') {
            // Ctrl+V: Pegar las shapes desde el portapapeles
            pastePart();
        }
    }
});

function changeColor() {
    const colorPicker = document.getElementById("colorPicker");
    const selectedColor = colorPicker.value;

    if (pickedMesh) {
        // Cambiar el color del material de la parte seleccionada
        pickedMesh.material = new BABYLON.StandardMaterial("material", scene);
        pickedMesh.material.diffuseColor = new BABYLON.Color3.FromHexString(selectedColor);
    }
}

function rgbToHex(r, g, b) {
    const toHex = (value) => {
        const hex = value.toString(16);
        return hex.length === 1 ? "0" + hex : hex;
    };
    
    const red = toHex(r);
    const green = toHex(g);
    const blue = toHex(b);
    
    return "#" + red + green + blue;
}

function hexToRgb(hex) {
    const trimmedHex = hex.replace(/^#/, "");
    
    if (trimmedHex.length === 3) {
        const r = parseInt(trimmedHex[0], 16) * 17;
        const g = parseInt(trimmedHex[1], 16) * 17;
        const b = parseInt(trimmedHex[2], 16) * 17;
        return { r, g, b };
    } else if (trimmedHex.length === 6) {
        const r = parseInt(trimmedHex.substring(0, 2), 16);
        const g = parseInt(trimmedHex.substring(2, 4), 16);
        const b = parseInt(trimmedHex.substring(4, 6), 16);
        return { r, g, b };
    }
    
    throw new Error("#000000");
}

const copyButton = document.getElementById("copy-button");
const cutButton = document.getElementById("cut-button");
const pasteButton = document.getElementById("paste-button");

// Variable para almacenar los elementos copiados o cortados
let copiedOrCutData = null;
let copiedPart = null;

// Evento para copiar
function copyPart() {
    if (pickedMesh) {
      copiedOrCutData = pickedMesh ? { ...pickedMesh } : null; // Clona la figura seleccionada
      copiedPart =  scene.getMeshByID(copiedOrCutData.id);
      copiedPartData = {
      mesh_id: randomName(),
      mesh_name: copiedPart.name,
      position:  [{
        x: copiedPart.position.x+20,
        y: copiedPart.position.y+20,
        z: copiedPart.position.z,
      }],
      rotation: [{
        x: BABYLON.Tools.ToDegrees(copiedPart.rotation.x),
        y: BABYLON.Tools.ToDegrees(copiedPart.rotation.y),
        z: BABYLON.Tools.ToDegrees(copiedPart.rotation.z),
      }],
      color: [copiedPart.material.diffuseColor]
    };
    }
  
}

// Evento para cortar
function cutPart() {
    if (pickedMesh) {
        copiedOrCutData = { ...pickedMesh }; // Clona la figura seleccionada
        // Elimina la figura seleccionada del arreglo shapes
        const index = jsonParts.indexOf(pickedMesh);
        if (index !== -1) {
            jsonParts.splice(index, 1);
        }
        scene.removeMesh(pickedMesh);
        pickedMesh.dispose();
        pickedMesh = null;
        
    }
}

// Evento para pegar
function pastePart() {
    if (pickedMesh) {
         if (copiedOrCutData) {
          // Concatena los elementos copiados o cortados al arreglo original
          jsonParts.push(copiedPartData);
          //console.log(copiedPartData);
          loadAndPositionPart(copiedPartData, new BABYLON.Vector3(0, 0, 0));
        }
   }
}

function randomName() {
    const allowedchars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';
    let randomName = '';

    for (let i = 0; i < 5; i++) {
        const randomIndex = Math.floor(Math.random() * allowedchars.length);
        randomName += allowedchars.charAt(randomIndex);
    }

    return randomName;
}
    </script>
</body>
</html>
